

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Glimmering Stars">
  <meta name="keywords" content="技术博客">
  
    <meta name="description" content="lifeCycle类组件生命周期介绍React 有两个重要阶段，render 阶段和 commit 阶段，React 在调和（render）阶段会深度遍历 React fiber 树，目的就是发现不同（diff），不同的地方就是接下来需要更新的地方，对于变化的组件，就会执行 render 函数。在一次调和过程完毕之后，就到了 commit 阶段，commit 阶段会创建修改真实的 DOM 节点。">
<meta property="og:type" content="article">
<meta property="og:title" content="lifeCycle">
<meta property="og:url" content="https://hgj1999.github.io/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/05-lifeCycle/index.html">
<meta property="og:site_name" content="点点星光的技术博客">
<meta property="og:description" content="lifeCycle类组件生命周期介绍React 有两个重要阶段，render 阶段和 commit 阶段，React 在调和（render）阶段会深度遍历 React fiber 树，目的就是发现不同（diff），不同的地方就是接下来需要更新的地方，对于变化的组件，就会执行 render 函数。在一次调和过程完毕之后，就到了 commit 阶段，commit 阶段会创建修改真实的 DOM 节点。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hgj1999.github.io/img/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/lifeCycle/lifeCycle01.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/21726284/1646966746152-0e3e28b9-334e-4777-8b32-6ea55003d187.png#clientId=u5fa9003e-03f6-4&from=paste&height=670&id=u39a971a2&originHeight=838&originWidth=696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=514692&status=done&style=none&taskId=u4c49d0a1-c118-49d2-929c-253e9e0c3a5&title=&width=556.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/21726284/1646966814123-177d22dd-ec68-4140-b29c-ccae492e253d.png#clientId=u5fa9003e-03f6-4&from=paste&height=653&id=uab494325&originHeight=816&originWidth=905&originalType=binary&ratio=1&rotation=0&showTitle=false&size=750724&status=done&style=none&taskId=uf64ec58e-8627-4a10-88f4-3c1141ee0e8&title=&width=724">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/21726284/1646966839110-bef2de0d-e3e3-4c59-ab21-0f2556c53072.png#clientId=u5fa9003e-03f6-4&from=paste&height=683&id=uc81df81b&originHeight=854&originWidth=693&originalType=binary&ratio=1&rotation=0&showTitle=false&size=179401&status=done&style=none&taskId=uf754ad8d-6958-4205-a2cf-720491ec69e&title=&width=554.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/21726284/1646966867328-af6519ae-e280-4c30-8568-3b852095b4d3.png#clientId=u5fa9003e-03f6-4&from=paste&height=418&id=u9003d170&originHeight=522&originWidth=1167&originalType=binary&ratio=1&rotation=0&showTitle=false&size=546345&status=done&style=none&taskId=uf8321983-c4b4-4e61-a232-0e540034e0b&title=&width=933.6">
<meta property="article:published_time" content="2023-07-18T05:56:15.000Z">
<meta property="article:modified_time" content="2023-07-18T09:12:51.619Z">
<meta property="article:author" content="Glimmering Stars">
<meta property="article:tag" content="React">
<meta property="article:tag" content="lifeCycle">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://hgj1999.github.io/img/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/lifeCycle/lifeCycle01.png">
  
  
  
  <title>lifeCycle - 点点星光的技术博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"hgj1999.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Glimmering Stars&#39; Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="lifeCycle"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-07-18 13:56" pubdate>
          2023年7月18日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          16k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          134 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="web前端"
        id="heading-348c88b2fce1b2a4dca21addc7a9b510" role="tab" data-toggle="collapse" href="#collapse-348c88b2fce1b2a4dca21addc7a9b510"
        aria-expanded="true"
      >
        web前端
        <span class="list-group-count">(40)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-348c88b2fce1b2a4dca21addc7a9b510"
           role="tabpanel" aria-labelledby="heading-348c88b2fce1b2a4dca21addc7a9b510">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="CSS"
        id="heading-2c56c360580420d293172f42d85dfbed" role="tab" data-toggle="collapse" href="#collapse-2c56c360580420d293172f42d85dfbed"
        aria-expanded="false"
      >
        CSS
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-2c56c360580420d293172f42d85dfbed"
           role="tabpanel" aria-labelledby="heading-2c56c360580420d293172f42d85dfbed">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/CSS/%E9%9A%8F%E8%AE%B0/" title="随记"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">随记</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="JavaScript"
        id="heading-686155af75a60a0f6e9d80c1f7edd3e9" role="tab" data-toggle="collapse" href="#collapse-686155af75a60a0f6e9d80c1f7edd3e9"
        aria-expanded="false"
      >
        JavaScript
        <span class="list-group-count">(6)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-686155af75a60a0f6e9d80c1f7edd3e9"
           role="tabpanel" aria-labelledby="heading-686155af75a60a0f6e9d80c1f7edd3e9">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/JavaScript/01.%E7%B2%BE%E7%A1%AE%E5%9B%9B%E5%88%99%E8%BF%90%E7%AE%97/" title="精确四则运算"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">精确四则运算</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="底层原理"
        id="heading-e971e343a0d37a51a1e03601a2c87f42" role="tab" data-toggle="collapse" href="#collapse-e971e343a0d37a51a1e03601a2c87f42"
        aria-expanded="false"
      >
        底层原理
        <span class="list-group-count">(4)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-e971e343a0d37a51a1e03601a2c87f42"
           role="tabpanel" aria-labelledby="heading-e971e343a0d37a51a1e03601a2c87f42">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/28/web%E5%89%8D%E7%AB%AF/JavaScript/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/01.%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" title="类型转换"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">类型转换</span>
        </a>
      
    
      
      
        <a href="/2023/04/28/web%E5%89%8D%E7%AB%AF/JavaScript/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/02.%E8%B0%83%E7%94%A8%E5%A0%86%E6%A0%88%E4%B8%8Ethis/" title="调用堆栈与this"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">调用堆栈与this</span>
        </a>
      
    
      
      
        <a href="/2023/04/28/web%E5%89%8D%E7%AB%AF/JavaScript/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/03.%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" title="内存管理"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">内存管理</span>
        </a>
      
    
      
      
        <a href="/2023/04/28/web%E5%89%8D%E7%AB%AF/JavaScript/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/04.%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/" title="作用域链和闭包"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">作用域链和闭包</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="模块化"
        id="heading-f7fa5f4adef4e53f3d9aeed9e2cc860c" role="tab" data-toggle="collapse" href="#collapse-f7fa5f4adef4e53f3d9aeed9e2cc860c"
        aria-expanded="false"
      >
        模块化
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-f7fa5f4adef4e53f3d9aeed9e2cc860c"
           role="tabpanel" aria-labelledby="heading-f7fa5f4adef4e53f3d9aeed9e2cc860c">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/01/web%E5%89%8D%E7%AB%AF/JavaScript/02.%E6%A8%A1%E5%9D%97%E5%8C%96/" title="模块化"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">模块化</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="React"
        id="heading-50ce2da63bea6a618e7578fa50690040" role="tab" data-toggle="collapse" href="#collapse-50ce2da63bea6a618e7578fa50690040"
        aria-expanded="true"
      >
        React
        <span class="list-group-count">(10)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-50ce2da63bea6a618e7578fa50690040"
           role="tabpanel" aria-labelledby="heading-50ce2da63bea6a618e7578fa50690040">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="原理"
        id="heading-b6724cffe9b1e39a5652a348831a4e0d" role="tab" data-toggle="collapse" href="#collapse-b6724cffe9b1e39a5652a348831a4e0d"
        aria-expanded="false"
      >
        原理
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-b6724cffe9b1e39a5652a348831a4e0d"
           role="tabpanel" aria-labelledby="heading-b6724cffe9b1e39a5652a348831a4e0d">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/07/31/web%E5%89%8D%E7%AB%AF/React/%E5%8E%9F%E7%90%86/01.%E4%BA%8B%E4%BB%B6%E5%8E%9F%E7%90%86/" title="事件原理"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">事件原理</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="基础"
        id="heading-0796ba76b4b553687e5ffaeb78512ccb" role="tab" data-toggle="collapse" href="#collapse-0796ba76b4b553687e5ffaeb78512ccb"
        aria-expanded="true"
      >
        基础
        <span class="list-group-count">(9)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-0796ba76b4b553687e5ffaeb78512ccb"
           role="tabpanel" aria-labelledby="heading-0796ba76b4b553687e5ffaeb78512ccb">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/01-JSX/" title="JSX"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">JSX</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/02-Component/" title="Component"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Component</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/03-State/" title="State"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">State</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/04-Props/" title="Props"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Props</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/05-lifeCycle/" title="lifeCycle"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">lifeCycle</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/06-Ref/" title="Ref"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Ref</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/07-Context/" title="Context"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Context</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/08-CSS%E6%A8%A1%E5%9D%97%E5%8C%96/" title="CSS模块化"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">CSS模块化</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/09-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/" title="高阶组件"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">高阶组件</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="TypeScript"
        id="heading-558b544cf685f39d34e4903e39c38b67" role="tab" data-toggle="collapse" href="#collapse-558b544cf685f39d34e4903e39c38b67"
        aria-expanded="false"
      >
        TypeScript
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-558b544cf685f39d34e4903e39c38b67"
           role="tabpanel" aria-labelledby="heading-558b544cf685f39d34e4903e39c38b67">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/21/web%E5%89%8D%E7%AB%AF/TypeScript/%E5%9F%BA%E7%A1%80/" title="基础"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">基础</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Vue2"
        id="heading-b5bc4fae52caba546fa469b33a1f7efd" role="tab" data-toggle="collapse" href="#collapse-b5bc4fae52caba546fa469b33a1f7efd"
        aria-expanded="false"
      >
        Vue2
        <span class="list-group-count">(8)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-b5bc4fae52caba546fa469b33a1f7efd"
           role="tabpanel" aria-labelledby="heading-b5bc4fae52caba546fa469b33a1f7efd">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="原理"
        id="heading-b6724cffe9b1e39a5652a348831a4e0d" role="tab" data-toggle="collapse" href="#collapse-b6724cffe9b1e39a5652a348831a4e0d"
        aria-expanded="false"
      >
        原理
        <span class="list-group-count">(6)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-b6724cffe9b1e39a5652a348831a4e0d"
           role="tabpanel" aria-labelledby="heading-b6724cffe9b1e39a5652a348831a4e0d">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue2/%E5%8E%9F%E7%90%86/01.observe/" title="observe"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">observe</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue2/%E5%8E%9F%E7%90%86/02.template/" title="template"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">template</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue2/%E5%8E%9F%E7%90%86/03.init%20render/" title="init render"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">init render</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue2/%E5%8E%9F%E7%90%86/04.update%20render/" title="update render"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">update render</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue2/%E5%8E%9F%E7%90%86/05.watch/" title="watch"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">watch</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue2/%E5%8E%9F%E7%90%86/06.computed/" title="computed"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">computed</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="生态"
        id="heading-2bbb08c8b90b98a98ee6940d899b794d" role="tab" data-toggle="collapse" href="#collapse-2bbb08c8b90b98a98ee6940d899b794d"
        aria-expanded="false"
      >
        生态
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-2bbb08c8b90b98a98ee6940d899b794d"
           role="tabpanel" aria-labelledby="heading-2bbb08c8b90b98a98ee6940d899b794d">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="vxe-table"
        id="heading-7e0799eacd75b19d26626e298e9212bf" role="tab" data-toggle="collapse" href="#collapse-7e0799eacd75b19d26626e298e9212bf"
        aria-expanded="false"
      >
        vxe-table
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-7e0799eacd75b19d26626e298e9212bf"
           role="tabpanel" aria-labelledby="heading-7e0799eacd75b19d26626e298e9212bf">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue2/%E7%94%9F%E6%80%81/vxe-table/%E8%B8%A9%E5%9D%91/" title="踩坑"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">踩坑</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="drag"
        id="heading-9fa45db736cfb8a6df80fcad7a79d7fd" role="tab" data-toggle="collapse" href="#collapse-9fa45db736cfb8a6df80fcad7a79d7fd"
        aria-expanded="false"
      >
        drag
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-9fa45db736cfb8a6df80fcad7a79d7fd"
           role="tabpanel" aria-labelledby="heading-9fa45db736cfb8a6df80fcad7a79d7fd">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="sortablejs"
        id="heading-f1d4baa153c3b58c7ad2556baf21f37e" role="tab" data-toggle="collapse" href="#collapse-f1d4baa153c3b58c7ad2556baf21f37e"
        aria-expanded="false"
      >
        sortablejs
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-f1d4baa153c3b58c7ad2556baf21f37e"
           role="tabpanel" aria-labelledby="heading-f1d4baa153c3b58c7ad2556baf21f37e">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/Vue2/%E7%94%9F%E6%80%81/vxe-table/%E9%9B%86%E6%88%90sortablejs%E5%AE%9E%E7%8E%B0%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD/" title="集成sortablejs实现拖拽功能"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">集成sortablejs实现拖拽功能</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Vue3"
        id="heading-79dcf464d3e1b41635e194883d0c939a" role="tab" data-toggle="collapse" href="#collapse-79dcf464d3e1b41635e194883d0c939a"
        aria-expanded="false"
      >
        Vue3
        <span class="list-group-count">(7)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-79dcf464d3e1b41635e194883d0c939a"
           role="tabpanel" aria-labelledby="heading-79dcf464d3e1b41635e194883d0c939a">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="原理"
        id="heading-b6724cffe9b1e39a5652a348831a4e0d" role="tab" data-toggle="collapse" href="#collapse-b6724cffe9b1e39a5652a348831a4e0d"
        aria-expanded="false"
      >
        原理
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-b6724cffe9b1e39a5652a348831a4e0d"
           role="tabpanel" aria-labelledby="heading-b6724cffe9b1e39a5652a348831a4e0d">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue3/%E5%8E%9F%E7%90%86/observe/" title="observe"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">observe</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="生态"
        id="heading-2bbb08c8b90b98a98ee6940d899b794d" role="tab" data-toggle="collapse" href="#collapse-2bbb08c8b90b98a98ee6940d899b794d"
        aria-expanded="false"
      >
        生态
        <span class="list-group-count">(6)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-2bbb08c8b90b98a98ee6940d899b794d"
           role="tabpanel" aria-labelledby="heading-2bbb08c8b90b98a98ee6940d899b794d">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="nuxt3"
        id="heading-fc69c1cad2d55a934383c957f4133484" role="tab" data-toggle="collapse" href="#collapse-fc69c1cad2d55a934383c957f4133484"
        aria-expanded="false"
      >
        nuxt3
        <span class="list-group-count">(6)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-fc69c1cad2d55a934383c957f4133484"
           role="tabpanel" aria-labelledby="heading-fc69c1cad2d55a934383c957f4133484">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue3/%E7%94%9F%E6%80%81/nuxt3/01.%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2%E5%A4%84%E7%90%86/" title="错误页面处理"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">错误页面处理</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue3/%E7%94%9F%E6%80%81/nuxt3/02.%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E6%96%B9%E6%A1%88/" title="错误页面处理"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">错误页面处理</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue3/%E7%94%9F%E6%80%81/nuxt3/03.%E5%AF%BC%E8%88%AA%E6%A0%8F%E9%94%9A%E7%82%B9/" title="导航栏锚点"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">导航栏锚点</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue3/%E7%94%9F%E6%80%81/nuxt3/04.%E6%B7%BB%E5%8A%A0%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1%E4%BB%A3%E7%A0%81/" title="添加百度统计代码"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">添加百度统计代码</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue3/%E7%94%9F%E6%80%81/nuxt3/05.cdn%E6%96%B9%E6%A1%88/" title="cdn 方案"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">cdn 方案</span>
        </a>
      
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/Vue3/%E7%94%9F%E6%80%81/nuxt3/06.%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" title="添加环境变量"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">添加环境变量</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="uniapp"
        id="heading-0094539787173fdbc36ecf1c1827193a" role="tab" data-toggle="collapse" href="#collapse-0094539787173fdbc36ecf1c1827193a"
        aria-expanded="false"
      >
        uniapp
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-0094539787173fdbc36ecf1c1827193a"
           role="tabpanel" aria-labelledby="heading-0094539787173fdbc36ecf1c1827193a">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/uniapp/%E8%B8%A9%E5%9D%91/" title="踩坑"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">踩坑</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="微信小程序"
        id="heading-439845b85c0a405cebc2e738b0786f15" role="tab" data-toggle="collapse" href="#collapse-439845b85c0a405cebc2e738b0786f15"
        aria-expanded="false"
      >
        微信小程序
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-439845b85c0a405cebc2e738b0786f15"
           role="tabpanel" aria-labelledby="heading-439845b85c0a405cebc2e738b0786f15">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E8%B8%A9%E5%9D%91/" title="踩坑"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">踩坑</span>
        </a>
      
    
      
      
        <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/Mixins%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/" title="Mixins 实现方案"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Mixins 实现方案</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="浏览器"
        id="heading-912302cb020149c37f9642fbc9e42891" role="tab" data-toggle="collapse" href="#collapse-912302cb020149c37f9642fbc9e42891"
        aria-expanded="false"
      >
        浏览器
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-912302cb020149c37f9642fbc9e42891"
           role="tabpanel" aria-labelledby="heading-912302cb020149c37f9642fbc9e42891">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/04/26/web%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8/01.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8Ejs/" title="浏览器与js"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">浏览器与js</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="滚动条"
        id="heading-47f0022e8e7a23f5a332273686eef9a7" role="tab" data-toggle="collapse" href="#collapse-47f0022e8e7a23f5a332273686eef9a7"
        aria-expanded="false"
      >
        滚动条
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-47f0022e8e7a23f5a332273686eef9a7"
           role="tabpanel" aria-labelledby="heading-47f0022e8e7a23f5a332273686eef9a7">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/07/27/web%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8/02.%E6%BB%9A%E5%8A%A8%E6%9D%A1/" title="滚动条"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">滚动条</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="项目技巧"
        id="heading-ec50b9dea63b6fd38b433e14854cc36a" role="tab" data-toggle="collapse" href="#collapse-ec50b9dea63b6fd38b433e14854cc36a"
        aria-expanded="false"
      >
        项目技巧
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-ec50b9dea63b6fd38b433e14854cc36a"
           role="tabpanel" aria-labelledby="heading-ec50b9dea63b6fd38b433e14854cc36a">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="用户登录状态"
        id="heading-f8674457fa9cdaf3d5dabc71e9377947" role="tab" data-toggle="collapse" href="#collapse-f8674457fa9cdaf3d5dabc71e9377947"
        aria-expanded="false"
      >
        用户登录状态
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-f8674457fa9cdaf3d5dabc71e9377947"
           role="tabpanel" aria-labelledby="heading-f8674457fa9cdaf3d5dabc71e9377947">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/07/27/web%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E6%8A%80%E5%B7%A7/01.%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81/" title="用户登录状态"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">用户登录状态</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="线上问题定位"
        id="heading-5be97ad5d1e33465328a4d92907367e8" role="tab" data-toggle="collapse" href="#collapse-5be97ad5d1e33465328a4d92907367e8"
        aria-expanded="false"
      >
        线上问题定位
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-5be97ad5d1e33465328a4d92907367e8"
           role="tabpanel" aria-labelledby="heading-5be97ad5d1e33465328a4d92907367e8">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/07/31/web%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E6%8A%80%E5%B7%A7/02.%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/" title="线上问题定位"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">线上问题定位</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">lifeCycle</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="lifeCycle"><a href="#lifeCycle" class="headerlink" title="lifeCycle"></a>lifeCycle</h1><h2 id="类组件生命周期介绍"><a href="#类组件生命周期介绍" class="headerlink" title="类组件生命周期介绍"></a>类组件生命周期介绍</h2><p>React 有两个重要阶段，render 阶段和 commit 阶段，React 在调和（render）阶段会深度遍历 React fiber 树，目的就是发现不同（diff），不同的地方就是接下来需要更新的地方，对于变化的组件，就会执行 render 函数。在一次调和过程完毕之后，就到了 commit 阶段，commit 阶段会创建修改真实的 DOM 节点。</p>
<p>如果在一次调和的过程中，发现了一个 <code>fiber tag = 1</code>类组件的情况，就会按照类组件的逻辑来处理。对于类组件的处理逻辑，首先判断类组件是否已经被创建过。</p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberBeginWork.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// workLoop React 处理类组件的主要功能方法</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateClassComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> shouldUpdate<br>  <span class="hljs-keyword">const</span> instance = workInProgress.<span class="hljs-property">stateNode</span> <span class="hljs-comment">// stateNode 是 fiber 指向 类组件实例的指针</span><br>  <span class="hljs-keyword">if</span> (instance === <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// instance 为组件实例，如果组件实例不存在，证明该类组件没有被挂载过，那么会走初始化流程</span><br>    <span class="hljs-title function_">constructClassInstance</span>(workInprogress, <span class="hljs-title class_">Component</span>, nextProps); <span class="hljs-comment">// 组件实例将在这个方法中被 new</span><br>    <span class="hljs-title function_">mountClassInstance</span>( workInProgress, <span class="hljs-title class_">Component</span>, nextProps, renderExpirationTime ); <span class="hljs-comment">// 初始化挂载组件流程</span><br>    shouldUpdate = <span class="hljs-literal">true</span>; <span class="hljs-comment">// shouldUpdate 标识用来证明 组件是否需要更新。</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    shouldUpdate = <span class="hljs-title function_">updateClassInstance</span>(current, workInProgress, <span class="hljs-title class_">Component</span>, nextProps, renderExpirationTime) <span class="hljs-comment">// 更新组件流程</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (shouldUpdate) &#123;<br>    nextChildren = instance.<span class="hljs-title function_">render</span>(); <span class="hljs-comment">// 执行 render 函数，得到子节点</span><br>    <span class="hljs-title function_">reconcileChildren</span>(current, workInprogress, nextChildren, renderExpirationTime) <span class="hljs-comment">// 继续调和子节点</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>几个重要概念：</p>
<ul>
<li><code>instace</code> 类组件对应实例。</li>
<li><code>workInProgress</code>树，当前正在调和的 fiber 树，一次更新中，React 回自上而下深度遍历子代 fiber，如果遍历到一个 fiber，会把当前 fiber 指向 workInProgress 。</li>
<li><code>current</code>树，在初始化更新中，current &#x3D; null，在第一次 fiber 调和之后，会将 workInProgress 树赋值给 current 树。React 用来 workInProgress 和current 来确保一次更新中，快速构建，并且状态不丢失。</li>
<li><code>Component</code>就是项目中的 class 组件</li>
<li><code>nextProps</code>作为组件在一次更新中新的 props</li>
<li><code>renderExpirationTime</code>作为下一次渲染的过期时间。</li>
</ul>
<p>在组件实例上可以通过 <code>_reactInternals</code> 属性来访问组件对应的 fiber 对象。在 fiber 对象上，可以通过 <code>stateNode</code>来访问当前 fiber 对应的组件实例。两者关系图如下</p>
<p><img src="/img/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/lifeCycle/lifeCycle01.png" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>React 的大部分生命周期的执行，都在 <code>mountClassInstance</code>和<code>updateClassInstance</code>这两个方法中被执行，。主要流程有 mount（初始化渲染）和 update（更新）两个方向。</p>
<h3 id="生命周期的三个阶段"><a href="#生命周期的三个阶段" class="headerlink" title="生命周期的三个阶段"></a>生命周期的三个阶段</h3><p>主要分为三个大阶段：<strong>组件初始化</strong>，<strong>组件更新</strong>，<strong>组件销毁</strong></p>
<h4 id="初始化阶段"><a href="#初始化阶段" class="headerlink" title="初始化阶段"></a>初始化阶段</h4><ul>
<li>constructor 执行</li>
</ul>
<p>在 mount 阶段，首先执行的 constructClassInstance 函数，用来实例化 React 组件，这个函数就是在 constructor 里面执行的</p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberClassComponent.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mountClassInstance</span>(<span class="hljs-params">workInProgress, ctor, newProps, renderExporationTime</span>) &#123;<br>  <span class="hljs-keyword">const</span> instance = workInProgress.<span class="hljs-property">stateNode</span>;<br>  <span class="hljs-keyword">const</span> getDerivedStateFromProps = ctor.<span class="hljs-property">getDerivedStateFromProps</span>;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> getDerivedStateFromProps === <span class="hljs-string">&#x27;function&#x27;</span>) &#123; <span class="hljs-comment">// ctor 就是我们写的类组件，获取组件的静态规范</span><br>    <span class="hljs-keyword">const</span> partialState = <span class="hljs-title function_">getDerivedStateFromProps</span>(nextProps, prevState);<span class="hljs-comment">// 这个时候执行 getDerivedStateFromProps 生命周期，得到将合并的 state</span><br>    <span class="hljs-keyword">const</span> memoizedState = partialState === <span class="hljs-literal">null</span> || partialState === <span class="hljs-literal">undefined</span> ? prevState : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, prevState, partialState); <span class="hljs-comment">// 合并 state</span><br>    instance.<span class="hljs-property">state</span> = workInProgress.<span class="hljs-property">memoizedState</span>; <span class="hljs-comment">// 将 state 赋值给我们的实例上，instance.state 就是我们组件中 this.state 获取 state</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ctor.<span class="hljs-property">getDerivedStateFromProps</span> !== <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> instance.<span class="hljs-property">getSnapshotBedoreUpdate</span> !== <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> instance.<span class="hljs-property">componentWillMount</span> === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>    instance.<span class="hljs-title function_">componentWillMount</span>(); <span class="hljs-comment">// 当getDerivedStateFromProps 和 getSnapshotBeforeUpdate 不存在的时候，执行 componentWillMount</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>getDerivedStateFromProps 执行<br>在初始化阶段，<code>getDerivedStateFromProps</code>是第二个执行的生命周期，值得注意的是它从 ctor 类上直接绑定的静态方法，传入 props，state。返回值将和之前的 state 合并，作为新的 state，传递给组件实例使用。 </li>
<li>componentWillMount 执行<br>如果存在 <code>getDerivedStateFromProps</code>和<code>getSnapshotBeforeUpdate</code>就不会执行生命周期<code>componentWillMount</code>。 </li>
<li>render 函数执行<br>到此为止<code>mountClassInstancec</code>函数完成，但是上面<code>updateClassComponent</code>函数，在执行完<code>mountClassInstacec</code>后，执行了 render 渲染函数，形成了 children，接下来 React 调用 reconcileChildren 方法深度调和 children。</li>
</ul>
<p>上面主要是 render 阶段</p>
<ul>
<li>componentDidMount 执行<br>一旦 React 调和完所有的 fiber 节点，就会到 commit 阶段，在组件初始化 commit 阶段，会调用 <code>componentDidMount</code> <blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberCommitWork.js</p>
</blockquote>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">commitLifeCycles</span>(<span class="hljs-params">finishedRoot, current, finishedWork</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (finishedWork.<span class="hljs-property">tag</span>) &#123;                <span class="hljs-comment">// fiber tag </span><br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ClassComponent</span>: &#123;                                     <span class="hljs-comment">// 如果是 类组件 类型</span><br>      <span class="hljs-keyword">const</span> instance = finishedWork.<span class="hljs-property">stateNode</span><span class="hljs-comment">// 类实例</span><br>      <span class="hljs-keyword">if</span>(current === <span class="hljs-literal">null</span>) &#123;                                 <span class="hljs-comment">// 类组件第一次调和渲染</span><br>        instance.<span class="hljs-title function_">componentDidMount</span>()<br>      &#125; <span class="hljs-keyword">else</span> &#123;                                                             <span class="hljs-comment">// 类组件更新</span><br>        instance.<span class="hljs-title function_">componentDidUpdate</span>(prevProps, prevState, instance.<span class="hljs-property">__reactInternalSnapshotBeforeUpdate</span>);<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>componentDidMount</code>执行时机 和 <code>componentDidUpdate</code>执行时机是相同的，只不过是针对初始化，一个针对组件的再更新。到此初始化阶段，生命周期执行完毕。</p>
<p>执行顺序：constructor -&gt; getDerivedStateFromProps &#x2F; componentWillMount -&gt; render -&gt; componentDidMount</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/21726284/1646966746152-0e3e28b9-334e-4777-8b32-6ea55003d187.png#clientId=u5fa9003e-03f6-4&from=paste&height=670&id=u39a971a2&originHeight=838&originWidth=696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=514692&status=done&style=none&taskId=u4c49d0a1-c118-49d2-929c-253e9e0c3a5&title=&width=556.8" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<h4 id="更新阶段"><a href="#更新阶段" class="headerlink" title="更新阶段"></a>更新阶段</h4><p>类组件的更新阶段，回到 <code>updateClassComponent</code>函数，当发现 current 不为 null 的情况下，说明该组件被挂载过，那么直接按照更新逻辑来处理。</p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberClassComponent.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateClassInstance</span>(<span class="hljs-params">current, workInProgress, ctor, newProps, renderExpirationTime</span>) &#123;<br>  <span class="hljs-keyword">const</span> instance = workInProgress.<span class="hljs-property">stateNode</span>; <span class="hljs-comment">// 类组件实例</span><br>  <span class="hljs-keyword">const</span> hasNewLifecycles = <span class="hljs-keyword">typeof</span> ctor.<span class="hljs-property">getDerivedStateFromProps</span> === <span class="hljs-string">&#x27;function&#x27;</span> <span class="hljs-comment">// 判断是否具有 getDerivedStateFromProps 生命周期</span><br>  <span class="hljs-keyword">if</span>(!hasNewLifecycles &amp;&amp; <span class="hljs-keyword">typeof</span> instace.<span class="hljs-property">componentWillReceiveProps</span> === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (oldProps !== newProps || oldContext !== nextContext) &#123; <span class="hljs-comment">// 浅比较 props 不相等</span><br>      instance.<span class="hljs-title function_">componentWillReceiveProps</span>(newProps, nextContext); <span class="hljs-comment">// 执行生命周期 componentWillReceiveProps</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">let</span> newState = (instance.<span class="hljs-property">state</span> = oldState);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> getDerivedStateFromProps === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>    ctor.<span class="hljs-title function_">getDerivedStateFromProps</span>(nextProps, prevState) <span class="hljs-comment">// 执行生命周期 getDerivedStateFromProps，逻辑和 mounted 类似，合并 state</span><br>    newState = workInProgress.<span class="hljs-property">memoizedState</span>;<br>  &#125;<br>  <span class="hljs-keyword">let</span> shouldUpdate = <span class="hljs-literal">true</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> instance.<span class="hljs-property">shouldComponentUpdate</span> === <span class="hljs-string">&#x27;function&#x27;</span>) &#123; <span class="hljs-comment">// 执行生命周期 shouldComponentUpdate 返回值决定是否执行 render，调和子节点</span><br>    ctor.<span class="hljs-title function_">getDerivedStateFromProps</span>(nextProps, prevState) <span class="hljs-comment">// 执行生命周期 getDerivedStateFromProps，逻辑和 mounted 类型，合并 state</span><br>    newState = workInProgress.<span class="hljs-property">memoizedState</span>;<br>  &#125;<br>  <span class="hljs-keyword">let</span> shouldUpdate = <span class="hljs-literal">true</span><br>  <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> instance.<span class="hljs-property">shouldComponentUpdate</span> === <span class="hljs-string">&#x27;function&#x27;</span>) &#123; <span class="hljs-comment">// 执行生命周期 shouldComponentUpdate 返回值决定是否执行 render，调和子节点</span><br>    shouldUpdate = instance.<span class="hljs-title function_">shouldComponentUpdate</span>(newProps, newState, nextContext);<br>  &#125;<br>  <span class="hljs-keyword">if</span>(shouldUpdate)&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> instance.<span class="hljs-property">componentWillUpdate</span> === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>      instance.<span class="hljs-title function_">componentWillUpdate</span>(); <span class="hljs-comment">// 执行生命周期 componentWillUpdate</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> shouldUpdate<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>执行生命周期 componentWillReceiveProps</strong></p>
<p>首先判断 <code>getDerivedStateFromProps</code>生命周期是否存在，如果不存在就执行<code>componentWillReceiveProps</code>生命周期。传入该生命周期两个参数，分别是 newProps 和 nextContext。</p>
<p><strong>执行生命周期 getDerivedStateFromProps</strong></p>
<p>接下来执行生命周期 <code>getDerivedStateFromProps</code>，返回的值用于合并 state，生成新的state。</p>
<p><strong>执行生命周期 shouldComponentUpdate</strong></p>
<p>接下来执行生命周期<code>shouldComponentUpdate</code>，传入新的 props，新的 state，和新的 context，返回值决定是否继续执行 render 函数，调和子节点。这里应该注意：getDerivedStateFromProps 的返回值可以作为新的 state，传递给 shouldComponentUpdate。</p>
<p><strong>执行生命周期 componentWillUpdate</strong></p>
<p>接下来执行生命周期 <code>componentWillUpdate</code>。updateClassInstance 方法到此执行完毕了。</p>
<p><strong>执行 render 函数</strong></p>
<p>接下来会执行 render 函数，得到最新的 React element 元素。然后继续调和子节点。</p>
<p><strong>执行 getSnapshotBeforeUpdate</strong></p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberCommitWork.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">commitBeforeMutationLifeCycles</span>(<span class="hljs-params">current, finishedWork</span>) &#123;<br>  <span class="hljs-keyword">switch</span>(finishedWork.<span class="hljs-property">tag</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ClassComponent</span>: &#123;<br>      <span class="hljs-keyword">const</span> snapshot = instance.<span class="hljs-title function_">getSnapshotBeforeUpdate</span>(prevProps, prevState) <span class="hljs-comment">// 执行生命周期 getSnapshotBeforeUpdate</span><br>      instance.<span class="hljs-property">__reactInternalSnapshotBeforeUpdate</span> = snapshot <span class="hljs-comment">// 返回值将作为__reactInternalSnapshotBeforeUpdate 传递给 componentDidUpdate 生命周期</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>getSnapshotBeforeUpdate</code>的执行也是再 commit 阶段，commit 阶段细分为 <code>beforeMutation</code>（DOM 修改前），<code>Mutation</code>（DOM 修改）,<code>Layout</code>（DOM 修改后）三个阶段，getSnapshotBeforeUpdate 发生在 <code>before Mutation</code>阶段，生命周期的返回值，将作为第三个参数 __reactInternalSnapshotBeforeUpdate 传递给 componentDidUpdate。</p>
<p><strong>执行 componentDidUpdate</strong></p>
<p>接下来执行生命周期 componentDidUpdate，此时 DOM 已经修改完成。可以操作修改之后的 DOM。到此为止更新阶段的生命周期执行完毕。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/21726284/1646966814123-177d22dd-ec68-4140-b29c-ccae492e253d.png#clientId=u5fa9003e-03f6-4&from=paste&height=653&id=uab494325&originHeight=816&originWidth=905&originalType=binary&ratio=1&rotation=0&showTitle=false&size=750724&status=done&style=none&taskId=uf64ec58e-8627-4a10-88f4-3c1141ee0e8&title=&width=724" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>更新阶段对应的生命周期的执行顺序：</p>
<p>componentWillReceiveProps（props 改变）&#x2F; getDerivedStateFromProp -&gt; shouldComponentUpdate -&gt; componentWillUpdate -&gt; render -&gt; getSnapshotBeforeUpdate -&gt; componentDidUpdate -&gt; componentDidUpdate</p>
<h4 id="销毁阶段"><a href="#销毁阶段" class="headerlink" title="销毁阶段"></a>销毁阶段</h4><blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberCommitWork.js</p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">function</span> <span class="hljs-title">callComponentWillUnmountWithTimer</span>() &#123;<br>  instance.componentWillUnmount();<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>执行生命周期 componentWillUnmount</strong></p>
<p>在一次调和更新中，如果发现元素被移除，就会打对应的 Deletion 标签，然后在 commit 阶段就会调用 <code>componentWillUnmount</code>生命周期，接下来统一卸载组件以及 DOM 元素。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/21726284/1646966839110-bef2de0d-e3e3-4c59-ab21-0f2556c53072.png#clientId=u5fa9003e-03f6-4&from=paste&height=683&id=uc81df81b&originHeight=854&originWidth=693&originalType=binary&ratio=1&rotation=0&showTitle=false&size=179401&status=done&style=none&taskId=uf754ad8d-6958-4205-a2cf-720491ec69e&title=&width=554.4" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>三个阶段生命周期+无状态组件总览图</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/21726284/1646966867328-af6519ae-e280-4c30-8568-3b852095b4d3.png#clientId=u5fa9003e-03f6-4&from=paste&height=418&id=u9003d170&originHeight=522&originWidth=1167&originalType=binary&ratio=1&rotation=0&showTitle=false&size=546345&status=done&style=none&taskId=uf8321983-c4b4-4e61-a232-0e540034e0b&title=&width=933.6" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<h2 id="React-各个阶段生命周期能做些什么"><a href="#React-各个阶段生命周期能做些什么" class="headerlink" title="React 各个阶段生命周期能做些什么"></a>React 各个阶段生命周期能做些什么</h2><h3 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h3><p>constructor 在类组件创建实例时调用，而且初始化的时候执行一次，所以可以在 constructor 中做一些初始化的工作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-variable language_">super</span>(props) <span class="hljs-comment">// 执行 super，传递 props，才能在接下来的上下文中，获取到 props。</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123; <span class="hljs-comment">// 可以用来初始化 state，比如可以用来获取路由中的</span><br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Bob&#x27;</span><br>  &#125;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>) <span class="hljs-comment">// 绑定 this</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleInputChange</span> = <span class="hljs-title function_">debounce</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">handleInputChange</span>, <span class="hljs-number">500</span>) <span class="hljs-comment">// 绑定防抖函数，防抖 500 毫秒</span><br>  <span class="hljs-keyword">const</span> _render = <span class="hljs-variable language_">this</span>.<span class="hljs-property">render</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">render</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> _render.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>) <span class="hljs-comment">// 劫持修改类组件上的一些生命周期</span><br>  &#125;<br>&#125;<br><span class="hljs-comment">// 点击事件</span><br><span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-comment">/* ... */</span>&#125;<br><span class="hljs-comment">// 表单输入</span><br><span class="hljs-title function_">handleInputChange</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-comment">/* ... */</span>&#125;<br></code></pre></td></tr></table></figure>

<p>constructor 作用：</p>
<ul>
<li>初始化 state，比如可以用来截取路由中的参数，赋值给 state。</li>
<li>对类组件的事件做一些处理，比如绑定 this，节流，防抖等。</li>
<li>对类组件进行一些必要生命周期的劫持，渲染劫持，这个功能更合适反向继承的 HOC，在 HOC  环节，会详细讲解反向继承这种模式</li>
</ul>
<h3 id="getDerivedStateFromProps"><a href="#getDerivedStateFromProps" class="headerlink" title="getDerivedStateFromProps"></a>getDerivedStateFromProps</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">getDerivedStateFromProps</span>(nextProps, prevState)<br></code></pre></td></tr></table></figure>

<p>两个参数：</p>
<ul>
<li>nextProps 父组件新传递的 props</li>
<li>prevState 组件在此次更新前的 state</li>
</ul>
<p><code>getDerivedStateFromProps</code>方法作为类的静态属性方法执行，内部是访问不到 <code>this</code> 的，它更趋向于纯函数，从源码中就能体会到 React 对该生命周期定义为取缔 componentWillMount 和 componentWillReceiveProps。</p>
<p>get | Derived | State | From | Props：得到 派生的 state 从 props 中</p>
<p>这个生命周期用于初始化和更新阶段，接收父组件的 props 数据，可以对 props 进行格式化，过滤等操作，返回值将作为新的 state 合并 到 state 中，供给视图渲染层消费。</p>
<p>从源码中可以看到，只要组件更新，就会执行 <code>getDerivedStateFromProps</code> ，不管是 props 改变，还是 setState，或是 forceUpdate。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromProps</span>(<span class="hljs-params">newProps</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; type &#125; = newProps<br>  <span class="hljs-keyword">switch</span>(type) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;fruit&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">list</span>:[<span class="hljs-string">&#x27;苹果&#x27;</span>,<span class="hljs-string">&#x27;香蕉&#x27;</span>,<span class="hljs-string">&#x27;葡萄&#x27;</span>] &#125; <span class="hljs-comment">// 接收 props 变化，返回值将作为新的  state，用于 渲染 或传递给 shouldComponentUpdate</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;vegetables&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">list</span>:[<span class="hljs-string">&#x27;菠菜&#x27;</span>,<span class="hljs-string">&#x27;西红柿&#x27;</span>,<span class="hljs-string">&#x27;土豆&#x27;</span>] &#125;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">return</span>() &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;this.state.list.map((item)=&gt;<span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item&#125;</span>&gt;</span>&#123; item &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>)&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure>

<p>getDerivedStateFromProps 作用：</p>
<ul>
<li>代替 componentWillMount 和 componentWillRectiveProps</li>
<li>组件初始化或者更新时，将 props 映射到 state</li>
<li>返回值与 state 合并完，可以作为 shouldComponentUpdate 第二个参数 newState，可以判断是否渲染组件。（getDerivedStateFromProps 和 shouldComponentUpdate 没有必然联系）</li>
</ul>
<h3 id="componentWillMount-和-UNSAFE-componentWillMount"><a href="#componentWillMount-和-UNSAFE-componentWillMount" class="headerlink" title="componentWillMount 和 UNSAFE_componentWillMount"></a>componentWillMount 和 UNSAFE_componentWillMount</h3><p>在 React V16.3 componentWillMount，componentWillReceiveProps，componentWillUpdate 三个生命周期加上不安全的标识 <code>UNSAFE</code>，变成了如下形式，在 React V17.0.2 也没有废弃这三个生命周期。可能不久之后更高级的版本会被废除，</p>
<p>为什么要加上不安全标识？</p>
<ul>
<li>因为这三个生命周期，都是在 render 之前执行的，React 对于执行 render 函数有着像 shouldUpdate 等条件制约，但是对于执行在 render 之前生命周期没有限制，存在一定隐匿风险，如果 updateClassInstance 执行多次，React 开发者滥用这几个生命周期，可能导致生命周期内的上下文多次被执行。 <ul>
<li>UNSAFE_componentWillMount</li>
<li>UNSAFE_componentWillReceiveProps</li>
<li>UNSAFE_componentWillUpdate</li>
</ul>
</li>
</ul>
<p>UNSAFE_componentWillMount 的作用还是做一些初始化操作，但是不建议在这个生命周期写，毕竟未来 React 可能完全取缔它。</p>
<h3 id="componentWillReceiveProps-和-UNSAFE-componentWillReceiveProps"><a href="#componentWillReceiveProps-和-UNSAFE-componentWillReceiveProps" class="headerlink" title="componentWillReceiveProps 和 UNSAFE_componentWillReceiveProps"></a>componentWillReceiveProps 和 UNSAFE_componentWillReceiveProps</h3><p>UNSAFE_componentWillReceivePRops 函数的执行是在更新组件阶段，该声明周期执行驱动时因为父组件更新带来的 props 修改，但是只要父组件触发 render 函数，调用 React.createElement 方法，那么 props 就会被重新创建，生命周期 componentWillReceiveProps 就会执行了。这就解释了即使 props 没变，该生命周期也会执行。</p>
<p>componentWillReceiveProps 的作用</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">UNSAFE_componentWillReceiveProps</span>(<span class="hljs-params">newProps</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; type &#125; = newProps<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;父组件 render 执行&#x27;</span>) <span class="hljs-comment">// 监听父组件执行 render</span><br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123; <span class="hljs-comment">// 异步控制 props 改变，派生出来的 state 的修改</span><br>    <span class="hljs-keyword">switch</span>(type)&#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;fruit&#x27;</span>:<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<span class="hljs-attr">list</span>:[<span class="hljs-string">&#x27;苹果&#x27;</span>,<span class="hljs-string">&#x27;香蕉&#x27;</span>,<span class="hljs-string">&#x27;葡萄&#x27;</span>]&#125;)<br>        <span class="hljs-keyword">break</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;vagetables&#x27;</span>:<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<span class="hljs-attr">list</span>:[<span class="hljs-string">&#x27;苹果&#x27;</span>,<span class="hljs-string">&#x27;香蕉&#x27;</span>,<span class="hljs-string">&#x27;葡萄&#x27;</span>]&#125;)<br>        <span class="hljs-keyword">break</span><br>    &#125;<br>  &#125;, <span class="hljs-number">0</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>componentWillReceiveProps 可以用来监听父组件是否执行 render。 </li>
<li>componentWillReceiveProps 可以用来接受 props 改变，组件可以根据 props 改变，来决定是否更新 state，因为可以访问到 this，所以可以在异步成功回调（接口请求数据）改变 state。这个是 getDerivedStateFromProps 不能实现的<br>不建议采用这种方式，props 改变，再触发 componentWillRectiveProps 异步请求数据渲染，这样首先在没做优化前提下会带来两次子组件的更新，第一次 props 改变，第二次 props 改变，异步改变 state。其次该生命周期的不安全性。再者需要在该生命周期内部，设置大量的条件判断语句，通过 this.props，nextProps 判断 props 到底改变与否。所以完全可以换一种思路，那就是状态提升，把数据层完全托管父组件，子组件没有副作用，只负责渲染父组件传递的 props 即可。</li>
</ul>
<p>当 props 不变的前提下，PureComponent 组件能否阻止 componentWillReceiveProps 执行？</p>
<p>不能，componentWillReceiveProps 生命周期的执行，和纯组件没有关系，纯组件是在 componentWillReceiveProps 执行之后浅比较 props 是否发生变化。所以 PureComponent 下不会阻止该生命周期的执行。</p>
<h3 id="componentWillUpdate-和-UNDAFE-componentWillUpdate"><a href="#componentWillUpdate-和-UNDAFE-componentWillUpdate" class="headerlink" title="componentWillUpdate 和 UNDAFE_componentWillUpdate"></a>componentWillUpdate 和 UNDAFE_componentWillUpdate</h3><p>UNSAFE_componentWillUpdate 可以意味着在更新之前，此时的 DOM 还没有更新。在这里可以做一些获取 DOM 的操作。就比如说在一次更新中，保存 DOM 之前的信息（记录上一次位置）。但是 React 已经出了新的生命周期 getSnapshotBeforeUpdate 来代替 UNSAFE_componentWillUpdate。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">UNSAFE_componentWillUpdate</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> position = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getPostion</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>) <span class="hljs-comment">// 获取元素节点 node 位置</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>作用：</p>
<ul>
<li>获取组件更新之前的状态。比如 DOM 元素位置等</li>
</ul>
<h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><p>render 函数就是 jsx 的各个元素被 React.createElement 创建成 React element 对象的形式。一次 render 的过程，就是创建 React.element 元素的过程。</p>
<ul>
<li>那么可以在 render 里面做一些 createElement 创建元素，cloneElement 克隆元素，React.children 遍历 children 的操作。</li>
</ul>
<h3 id="getSnapshotBeforeUpdate"><a href="#getSnapshotBeforeUpdate" class="headerlink" title="getSnapshotBeforeUpdate"></a>getSnapshotBeforeUpdate</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">getSnapshotBeforeUpdate</span>(<span class="hljs-params">prevProps, preState</span>)&#123;&#125;<br></code></pre></td></tr></table></figure>

<p>两个参数：</p>
<ul>
<li>prevProps 更新前的 props</li>
<li>preState 更新前的 state</li>
</ul>
<p>把 getSnapshotBeforeUpdate 拆分一下 get | snap shot | before | update，中文翻译：<strong>获取更新前的快照</strong>，可以进一步理解为 获取更新前 DOM 的状态。该生命周期是在 commit 阶段的 before Mutation（DOM 修改前），此时 DOM 还没有更新，但是在接下来的 Mutation 阶段会被替换成真实 DOM。此时是获取 DOM 信息的最佳时期，getSnapshotBeforeUpdate 将返回一个值作为一个<code>snapShot</code>（快照），传递给 componentDidUpdate 作为第三个参数。</p>
<p>注意：如果没有返回值会给予警告，如果没有 <code>componentDidUpdate</code>也会给予警告。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">getSnapshotBeforeUpdate</span>(<span class="hljs-params">prevProps, preState</span>) &#123;<br>  <span class="hljs-keyword">const</span> sytle = <span class="hljs-title function_">getComputedStyle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>)<br>  <span class="hljs-keyword">return</span> &#123; <span class="hljs-comment">// 传递更新前的元素位置</span><br>    <span class="hljs-attr">cx</span>: style.<span class="hljs-property">cx</span>,<br>    <span class="hljs-attr">cy</span>: style.<span class="hljs-property">cy</span><br>  &#125;<br>&#125;<br><span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params">prevProps, prevState, snapshot</span>) &#123;<br>  <span class="hljs-comment">// 获取元素绘制之前的位置</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(snapshot)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个快照 <code>snapShot</code>不限于 DOM 的信息，也可以是根据 DOM 计算出来的产物。</p>
<p>作用：</p>
<ul>
<li>getSnapshotBeforeUpdate 这个生命周期意义就是配合 componentDidUpdate 一起使用，计算形成一个 snapShot 传递给 componentDidUpdate。保存一次更新前的信息。</li>
</ul>
<h3 id="componentDidUpdate"><a href="#componentDidUpdate" class="headerlink" title="componentDidUpdate"></a>componentDidUpdate</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params">prevProps, prevState, snapshot</span>) &#123;<br>  <span class="hljs-keyword">const</span> style = <span class="hljs-title function_">getComputedStyle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>)<br>  <span class="hljs-keyword">const</span> newPosition = &#123; <span class="hljs-comment">// 获取元素最新位置信息</span><br>    <span class="hljs-attr">cx</span>: style.<span class="hljs-property">cx</span>,<br>    <span class="hljs-attr">cy</span>: style.<span class="hljs-property">cy</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>三个参数：</p>
<ul>
<li>prevProps 更新之前的 props</li>
<li>prevState 更新之前的 state</li>
<li>snapshot 为 getSnapshotBeforeUpdate 返回的快照，可以是更新前的 DOM 信息。</li>
</ul>
<p>作用：</p>
<ul>
<li>componentDidUpdate 生命周期执行，此时 DOM 已经更新，可以直接获取 DOM 最新状态。这个函数里面如果想要使用 setState，一定要加以限制，否则会引起无限循环。</li>
<li>接受 getSnapshotBeforeUpdate 保存的快照信息。</li>
</ul>
<h3 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount"></a>componentDidMount</h3><p>componentDidMount 生命周期执行时机和 componentDidUpdate 一样，一个是在<strong>初始化</strong>，一个是<strong>组件更新</strong>，此时 DOM 已经创建完，既然 DOM 已经创建挂载，就可以做一些基于 DOM 操作， DOM 事件监听器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">addEventLister</span>(<span class="hljs-string">&#x27;click&#x27;</span>,<span class="hljs-function">()=&gt;</span>&#123;<br>    <span class="hljs-comment">// 事件监听</span><br>  &#125;)<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getData</span>() <span class="hljs-comment">// 数据请求</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>作用：</p>
<ul>
<li>可以做一些关于 DOM 操作，比如基于 DOM 的事件监听器。</li>
<li>对于初始化向服务器请求数据，渲染视图，这个生命周期非常合适。</li>
</ul>
<h3 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate"></a>shouldComponentUpdate</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">shouldComponentUpdate</span>(<span class="hljs-params">newProps, newState, nextContext</span>)&#123;&#125;<br></code></pre></td></tr></table></figure>

<p>shouldComponentUpdate 三个参数，第一个参数新的 props，第二个参数新的 state，第三个参数新的 context。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">shouldComponentUpdate</span>(<span class="hljs-params">newProps, newState</span>) &#123;<br>  <span class="hljs-keyword">if</span>(newProps.<span class="hljs-property">a</span> !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">a</span>) &#123; <span class="hljs-comment">// props 中 a 属性发生变化 渲染组件</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(newState.<span class="hljs-property">b</span> !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">b</span>) &#123; <span class="hljs-comment">// state 中 b 属性发生变化 渲染组件</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// 否则组件不渲染</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>这个生命周期，一般用于性能优化，shouldComponentUpdate 返回值决定是否重新渲染的类组件。需要重点关注的是第二个参数 newState，如果有 getDerivedStateFromProps 生命周期，它的返回值将合并到 newState，供 shouldComponentUpdate 使用。</li>
</ul>
<h3 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount"></a>componentWillUnmount</h3><p>componentWillUnmount 是组件销毁阶段唯一执行的生命周期，主要做一些收尾工作，比如清理一些可能会造成内存泄漏的定时器，延时器，或者是一些事件监听器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>) <span class="hljs-comment">// 清除延时器</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handerClick</span>) <span class="hljs-comment">// 卸载事件监听器</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>作用</p>
<ul>
<li>清理延时器，定时器</li>
<li>一些基于 DOM 的操作，比如事件监听器</li>
</ul>
<h2 id="函数组件生命周期替代方案"><a href="#函数组件生命周期替代方案" class="headerlink" title="函数组件生命周期替代方案"></a>函数组件生命周期替代方案</h2><h3 id="useEffect-和-useLayoutEffect"><a href="#useEffect-和-useLayoutEffect" class="headerlink" title="useEffect 和 useLayoutEffect"></a>useEffect 和 useLayoutEffect</h3><p><strong>useEffect</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> destory<br>&#125;,dep)<br></code></pre></td></tr></table></figure>

<p>useEffect 第一个参数 callback，返回的 destory，destory 作为下一次 callback 执行之前调用，用于清除上一次 callback 产生的副作用。</p>
<p>第二个参数作为依赖项，是一个数组，可以有多个依赖项，以来项改变，执行上一次 callback 返回的 destory，和执行新的 effect 第一个参数 callback。React 会像 <code>setTimeout</code>回调函数一样，放入任务队列，等到主线程任务完成，DOM 更新，js 执行完成，视图绘制完毕，才执行。所以 effect 回调函数不会阻塞浏览器绘制视图。</p>
<p><strong>useLayoutEffect</strong></p>
<p>useLayoutEffect 和  useEffect 不同的地方是采用了同步执行，区别：</p>
<ul>
<li>首先 useLayoutEffect 是在 DOM 绘制之前·，这样可以方便修改 DOM，这样浏览器只会绘制一次，如果修改 DOM 布局放在 useEffect，那 useEffect 执行是在浏览器绘制视图之后，接下来又改 DOM，就可能会导致浏览器再次回流重绘。而且由于两次绘制，视图上可能会造成闪现突兀的效果。</li>
<li>useLayoutEffect callback 中代码执行会阻塞浏览器绘制。</li>
</ul>
<p><strong>修改 DOM ，改变布局就用 useLayoutEffect，其他情况就用 useEffect。</strong></p>
<p>useEffect 对 React 执行栈来看是异步执行的，而 componentDidMount&#x2F;componentDidUpdate 是同步执行的，useEffect 代码不会阻塞浏览器绘制。在时机上，componentDidMount&#x2F;componentDidUpdate 和 useLayoutEffect 更类似。</p>
<h3 id="componentDidMount-替代方案"><a href="#componentDidMount-替代方案" class="headerlink" title="componentDidMount 替代方案"></a>componentDidMount 替代方案</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 请求数据，事件监听，操作 dom</span><br>&#125;,[]) <span class="hljs-comment">// 切记 dep = []</span><br></code></pre></td></tr></table></figure>

<p>在 componentDidMount 的前提下，useEffect 第一函数的返回函数，可以作为 componentWillUnmount 使用。</p>
<h3 id="componentWillUnmount-方案"><a href="#componentWillUnmount-方案" class="headerlink" title="componentWillUnmount 方案"></a>componentWillUnmount 方案</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>  <span class="hljs-comment">// 请求数据，事件监听，操作dom，增加定时器，延时器</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">// 解除事件监听器，清除定时器，延时器</span><br>  &#125;<br>&#125;,[]) <span class="hljs-comment">// 切记 dep = []</span><br></code></pre></td></tr></table></figure>

<p>在 componentDidMount 的前提下，useEffect 第一个函数的返回函数，可以作为 ccomponentWillUnmount 使用。</p>
<h3 id="componentWillReceiveProps-替代方案"><a href="#componentWillReceiveProps-替代方案" class="headerlink" title="componentWillReceiveProps 替代方案"></a>componentWillReceiveProps 替代方案</h3><ul>
<li>useEffect 和 componentWillReceiveProps 执行阶段不同，一个是在 render 阶段，一个是在commit 阶段。</li>
<li>其次 useEffect 会初始化执行一次，但是 componentWillReceiveProps 只有在组件更新 props 变化的时候才会执行。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;props变化：componentWillReceiveProps&#x27;</span>)<br>&#125;,[ props ])<br></code></pre></td></tr></table></figure>

<p>此时依赖性就是 props，props 变化，执行此时的 useEffect 钩子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;props中number变化：componentWillReceiveProps&#x27;</span>)<br>&#125;,[props,number]) <span class="hljs-comment">// 当前仅仅当 props 中 number 变化，执行当前 effect 钩子</span><br></code></pre></td></tr></table></figure>

<p>useEffect 还可以针对 props 的某一个属性进行追踪。此时依赖项为 props 的追踪属性。上述代码，只有 props 中的 number 变化，执行 effect。</p>
<h3 id="componentDidUpdate-替代方案"><a href="#componentDidUpdate-替代方案" class="headerlink" title="componentDidUpdate 替代方案"></a>componentDidUpdate 替代方案</h3><p>useEffect 和 componentDidUpdate 在执行时期虽然有点差别，useEffect 是异步执行，componentDidUpdate 是同步执行，但都是在 commit 阶段。但是 useEffect 会默认执行一次，而 componentDidUpdate 只有在组件更新完成之后执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;组件更新完成：componentDidUpdate&#x27;</span>)<br>&#125;) <span class="hljs-comment">// 没有 dep 依赖项</span><br></code></pre></td></tr></table></figure>

<p>注意此时 useEffect 没有第二个参数</p>
<p>没有第二个参数，那么每一次执行函数组件，都会执行该 effect。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/web%E5%89%8D%E7%AB%AF/" class="category-chain-item">web前端</a>
  
  
    <span>></span>
    
  <a href="/categories/web%E5%89%8D%E7%AB%AF/React/" class="category-chain-item">React</a>
  
  
    <span>></span>
    
  <a href="/categories/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/" class="category-chain-item">基础</a>
  
  

  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/React/">#React</a>
      
        <a href="/tags/lifeCycle/">#lifeCycle</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>lifeCycle</div>
      <div>https://hgj1999.github.io/2023/07/18/web前端/React/基础/05-lifeCycle/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Glimmering Stars</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年7月18日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/04-Props/" title="Props">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Props</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/07/18/web%E5%89%8D%E7%AB%AF/React/%E5%9F%BA%E7%A1%80/06-Ref/" title="Ref">
                        <span class="hidden-mobile">Ref</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
      Ever Forward
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
